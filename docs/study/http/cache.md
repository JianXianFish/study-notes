---
title: HTTP缓存
---
## 什么是HTTP缓存
> 当客户端向服务器请求资源时，会先抵达浏览器缓存，如果浏览器有"目标请求资源"的副本，就可以直接从浏览器缓存中提取而不是从原始服务器中提取这个资源

常见的http换窜只能缓存get请求响应的资源，对于其他类型的响应则无能为力。
### 原理
http缓存都是从第二次请求开始的
* 第一次请求资源时，服务器返回资源，并在响应头（response-header）中回传缓存参数
* 第二次请求时，浏览器判断这些请求参数，命中强制缓存的直接返回200，否则吧请求参数加到请求头（request-header）中传给服务器，看是否命中协商缓存，命中则返回304，否则服务器会返回新的资源


## HTTP缓存分类

根据是否需要重新向服务器发起请求来分类，可分为：**强制缓存** 和 **协商缓存**

根据是否可以被单个或者多个用户使用来分类，可分为：**私有缓存** 和 **共享缓存**

> 强制缓存如果生效，不需要再和服务器发生交互。而协商缓存不管是否生效，都需要和服务器发生交互。

### **强制缓存**
* 强制缓存在未失效的情况下（即Cache-Control的max-age没有过期或者Expires的缓存时间没有过期），那么就会直接使用浏览器的缓存数据，不会向服务器发送任何请求。
* 强制缓存生效时，http状态码为200
* 这种方式的加载速度是最快的，性能也是最好的，但是在这期间，如果服务器的资源修改了，页面上是拿不到的，因为他不会想服务器发请求。

### **协商缓存**
* 当第一次请求服务器返回的响应头中没有`Cache-Control`和`Expires`或者`Cache-Control`和`Expires`过期了，还或者它的属性设置为`no-cache`时（即不走强制缓存），那么浏览器第二次请求时就会与服务器进行协商，与服务器端对比判断资源是否进行了修改更新。
* 如果服务器的资源没有修改就会返回304，告诉浏览器可以使用缓存中的数据，这样就减少了服务器的数据传输压力。
* 如果数据有更新就会返回200状态码，服务器就会返回更新后的资源并且将缓存信息一起返回。

### **强制缓存和协商缓存的对比**
 |   | 强制缓存 | 协商缓存 |
| -- | -- | -- |
| 缓存存放位置 | 本地浏览器 | 本地浏览器 |
| http状态码 | 200 | 304 |
| 谁来决定 | `Pragma` `Cache-Control` `Expires` | `ETag/If-Not-Match` `Last-Modified/If-Modified-Since` |
| 操作是否有效| 1、Ctrl+F5强制刷新 -- 无效</br>2、F5刷新 -- 无效</br>3、地址栏回车 -- 有效</br>4、页面链接跳转 -- 有效</br>5、新开窗口 -- 有效</br>6、前进、后退 -- 有效 | 1、Ctrl+F5强制刷新 -- 无效</br>2、F5刷新 -- 有效</br>3、地址栏回车 -- 有效</br>4、页面链接跳转 -- 有效</br>5、新开窗口 -- 有效</br>6、前进、后退 -- 有效 |
