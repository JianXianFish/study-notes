---
title: 地址栏输入url后发生了什么
---

## 简单分析
简单分析，从URL到回车后发生的行为：
* URL解析
* DNS查询
* TCP链接
* HTTP请求
* 响应请求
* 渲染页面

## 详细分析
### **1.URL解析**
> 首先判断你输入的是一个合法的URL还是一个待搜索关键字，并且根据你输入的内容进行对应操作

url的解析：

`https://learn.mrfish.top:80/study/http/urlToEnter?key=hello#详细分析`

* `https://`：协议一般是`http`或者`https`
* `learn.mrfish.top`：域名，通过DNS解析后得到对应的ip地址，确定服务器地址
* `:80`：端口号，`http`默认80端口，`https`默认443端口，确定服务器中的具体应用
* `/study/http/urlToEnter`：路径，确定访问资源的位置
* `?key=hello`：查询字符串，对请求的资源有更加纤细的描述
* `#详细分析`：锚点链接，同上


### **2.DNS查询**
> 解析成功获取到一个合法URL后，就会进行DNS查询，详细过程如下

* 首先搜索浏览器的DNS缓存，缓存中维护一张域名和IP地址对应表
* 若没有命中，则继续搜索操作系统的DNS缓存
* 若仍没有命中，则操作系统将域名发送至本地域名服务器，本地域名服务器采用递归查询自己的DNS缓存，查找成功则返回结果
* 若本地域服务器的DNS缓存没有命中，则本地域名服务器向上级域名服务器进行迭代查询
  * 首先本地域名服务器向根域名服务器发起请求，根域名服务器返回顶级域名服务器地址给本地域名服务器
  * 本地域名服务器拿到这个顶级域名服务器地址后，就向其发起请求，获取权限域名服务器地址
  * 本地服务器根据权限域名服务器的地址向其发起请求，最终得到该域名对应的IP地址
* 本地域名服务器得到IP地址返回给操作系统，同时自己将ip地址缓存起来
* 操作系统将IP地址返回给服务器，同时自己将IP地址缓存起来
* 致辞，浏览器得到域名对应的IP地址，并将IP地址缓存起来

### **3.TCP链接**
> 确定服务器的IP地址后，则精力三次握手简历TCP链接，简单流程如下
```
        |   ————————————————发送标有SYN的数据包——————————————————>    |
客户端   |   <—————————————发送标有SYN/ACK的数据包————————————————     |   服务器端
        |   ———————————————发送标有ACK的数据包———————————————————>    |
```
* 第一次握手：客户端给服务器端发送一个SYN保温，并指明客户端的初始化序列号ISN，此时和护短处于SYN_SENt状态
* 第二次握手：服务器端收到客户端的SYN报文之后，会以自己的SYN报文作为应答，为了确定客户端的SYN，将客户端的ISN+1作为ACK的值，此时服务器端处于SYN_RCVD的状态
* 第三次握手：客户端收到SYN报文之后，会发送一个ACK报文，值为服务器的ISN+1。此时客户端处于ESTABLISHED状态。服务器收到ACK报文后，也处于ESTABLISHED状态，此时，双方已经建立起了链接

***上述握手的作用***
* 第一次握手：<u>客户端发送网络包，服务器接收到</u>，这样服务器就能得到结论：**客户端的发送能力，服务端的接收能力正常**。
* 第二次握手：<u>服务端发包，客户端收到了</u>，这样客户端就能得到结论：**服务端的接收、发送能力，客户端的发送能力都是正常的**。不过此时服务器并不能确认客户端的接收能力是否正常
* 第三次握手：<u>客户端发包，服务器收到了</u>，这样服务端就能得出结论：**客户端的接收、发送能力正常，服务器自己的发送、接收能力也正常**

### **4.HTTP请求**
> 当建立`TCP`链接后，就可以在这基础上通信，浏览器发红`http`请求到目标服务器, 请求内容包括：
> * 请求行
> * 请求头
> * 请求主体

### **6.响应请求**
> 当服务器接收到浏览器请求之后，就会进行逻辑操作，处理完成之后返回一个`HTTP`响应消息，包括：
> * 状态行
> * 响应头
> * 响应正文

在服务器响应之后，由于现在`http`默认开始长链接`keep-alive`，当关闭页面之后，`tcp`链接则会经过四次挥手完成断开

### **7.渲染页面**
> 当浏览器接收到服务器响应的资源后，首先会对资源进行解析：
> * 查看响应头的信息，根据不同的指示做对应处理，比如重定向，存储cookie，解压gzip，缓存资源等等
> * 查看响应头的`Content-type`的值，根据不同的资源类型采用不同的解析方式

**关于页面渲染过程：**
1. 解析html，构建DOM树
2. 解析CSS，生成CSS规则树
3. 合并DOM树和CSS规则树，生成render树
4. 布局render树（Layout / reflow），负责各元素尺寸、位置的计算
5. 绘制render树（paint），绘制页面像素信息
6. 浏览器会将各层的信息发送给GPU，GPU会将各层合成，显示在屏幕上


